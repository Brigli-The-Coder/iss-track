<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>ISS Live Tracker â€” Universe Layout</title>

<!-- Bootstrap 5 CSS -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap" rel="stylesheet">

<style>
body {
  margin: 0;
  font-family: 'Orbitron', sans-serif;
  background: #000;
  color: #fff;
  background-image: url('https://img.freepik.com/free-photo/earth-seen-from-space_23-2150528643.jpg');
  background-size: cover;
  background-repeat: no-repeat;
  background-position: center;
}

.container-custom {
  background: rgba(0,0,0,0.6);
  padding: 20px;
  border-radius: 12px;
  box-shadow: 0 0 30px rgba(0,255,255,0.2);
  margin-bottom: 20px;
}

#map {
  height: 60vh;
  border-radius: 12px;
  border: 1px solid #0ff;
}

h2 {
  text-align: center;
  color: #0ff;
  margin-bottom: 10px;
  text-shadow: 0 0 10px #0ff;
}

#fullscreenModal {
  position: fixed;
  top: 0; left: 0;
  width: 100%; height: 100%;
  background-image: url('0_Earth_Planet_3840x2160.mp4');
  background-size: cover;
  background-position: center;
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 1000;
  opacity: 1;
  transform: scale(1);
  transition: transform 1s ease, opacity 1s ease;
}

#fullscreenModal h1 {
  color: transparent;
  font-size: 3em;
  -webkit-text-stroke: 1px #0ff;
  text-align: center;
}

@media (max-width: 768px) {
  .container-custom { padding: 15px; }
  #map { height: 50vh; }
  h2 { font-size: 1.8em; }
  #fullscreenModal h1 { font-size: 2.5em !important; }
}

@media (max-width: 480px) {
  #map { height: 45vh; }
  h2 { font-size: 2em; }
  #fullscreenModal h1 { font-size: 2em !important; }
}
</style>
</head>
<body>

<div class="container container-custom row justify-content-center" id="input-container">
  <div class="col-md-3 col-5 mb-2">
    <label>Latitude: <input id="input-lat" class="form-control text-center" value="42.068" /></label>
  </div>
  <div class="col-md-3 col-5 mb-2">
    <label>Longitude: <input id="input-lon" class="form-control text-center" value="19.512" /></label>
  </div>
</div>

<div class="container container-custom" id="info">
  Loading ISS data...
</div>

<div class="container container-custom" id="map"></div>

<script src="https://unpkg.com/satellite.js/dist/satellite.min.js"></script>
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<!-- Audio dhe Modal -->
<audio id="openSound" src="./mixkit-deep-space-atmosphere-2009.wav"></audio>

<div id="fullscreenModal">
  <video autoplay muted loop playsinline 
         style="position:absolute; top:0; left:0; width:100%; height:100%; object-fit:cover; z-index:-1;">
    <source src="0_Earth_Planet_3840x2160.mp4" type="video/mp4">
  </video>
  <h1>Welcome to the ISS Live Tracker ðŸš€</h1>
</div>

<script>
// Modal me audio
const modal = document.getElementById('fullscreenModal');
const openSound = document.getElementById('openSound');
modal.addEventListener('click', () => {
  openSound.play();
  modal.style.transform = 'scale(3)';
  modal.style.opacity = '0';
  setTimeout(() => modal.style.display='none', 1000);
});

// Initial lat/lon
let obsLat = parseFloat(document.getElementById('input-lat').value);
let obsLon = parseFloat(document.getElementById('input-lon').value);
const info = document.getElementById('info');

// Harta satellite view
const map = L.map('map').setView([obsLat, obsLon], 5);
L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
    attribution: 'Tiles &copy; Esri &mdash; Source: Esri, NASA, USGS',
    maxZoom: 19
}).addTo(map);

let observerMarker = L.marker([obsLat,obsLon]).addTo(map).bindPopup('ShkodÃ«r').openPopup();
let issMarker = null, issTrail = null;

document.getElementById('input-lat').addEventListener('change',(e)=>{
  obsLat=parseFloat(e.target.value);
  observerMarker.setLatLng([obsLat,obsLon]);
  map.setView([obsLat,obsLon],5);
});
document.getElementById('input-lon').addEventListener('change',(e)=>{
  obsLon=parseFloat(e.target.value);
  observerMarker.setLatLng([obsLat,obsLon]);
  map.setView([obsLat,obsLon],5);
});

// TLE i fiksuar (punon gjithmonÃ«)
const tleLine1 = "1 25544U 98067A   25303.54055635  .00021058  00000+0  40487-3 0  9994";
const tleLine2 = "2 25544  51.6457 327.6030 0009519 307.5690  52.4402 15.49736178361034";
const satrec = satellite.twoline2satrec(tleLine1, tleLine2);

function getLatLon(satrec,date){
  const pv = satellite.propagate(satrec,date);
  if(!pv.position) return null;
  const gmst = satellite.gstime(date);
  const pos = satellite.eciToGeodetic(pv.position,gmst);
  return {
    lat:satellite.radiansToDegrees(pos.latitude),
    lon:satellite.radiansToDegrees(pos.longitude)
  };
}

function elevation(satrec, date){
  const pv = satellite.propagate(satrec,date);
  if(!pv.position) return -1;
  const gmst = satellite.gstime(date);
  const posEcf = satellite.eciToEcf(pv.position, gmst);
  const observerGd = {
    latitude: satellite.degreesToRadians(obsLat),
    longitude: satellite.degreesToRadians(obsLon),
    height: 0
  };
  const obsEcf = satellite.geodeticToEcf(observerGd);
  const rx = posEcf.x - obsEcf.x;
  const ry = posEcf.y - obsEcf.y;
  const rz = posEcf.z - obsEcf.z;
  const lat = observerGd.latitude;
  const lon = observerGd.longitude;
  const sinLat = Math.sin(lat), cosLat = Math.cos(lat);
  const sinLon = Math.sin(lon), cosLon = Math.cos(lon);
  const topX = -sinLon*rx + cosLon*ry;
  const topY = -cosLon*sinLat*rx - sinLat*sinLon*ry + cosLat*rz;
  const topZ = cosLat*cosLon*rx + cosLat*sinLon*ry + sinLat*rz;
  const rangeKm = Math.sqrt(topX*topX + topY*topY + topZ*topZ);
  const el = Math.asin(topZ/rangeKm) * 180/Math.PI;
  return el;
}

(function updateLoop(){
  const speedKmS = 7.66;
  function update(){
    const now = new Date();
    const pos = getLatLon(satrec, now);
    if(!pos) return;

    if(issMarker) issMarker.setLatLng([pos.lat,pos.lon]);
    else issMarker = L.circleMarker([pos.lat,pos.lon],{
      radius:10,
      color:'#0ff',
      fillColor:'#0ff',
      fillOpacity:1
    }).addTo(map).bindPopup('ISS Current Position').openPopup();

    const points=[];
    for(let t=0;t<=120;t+=5){
      const future = getLatLon(satrec,new Date(now.getTime()+t*1000));
      if(future) points.push([future.lat,future.lon]);
    }
    if(issTrail) map.removeLayer(issTrail);
    issTrail = L.polyline(points,{color:'#f0f',weight:2,opacity:0.8}).addTo(map);

    let nextPassMin = '-';
    for(let t=0;t<24*60*60;t+=10){
      const future = new Date(now.getTime()+t*1000);
      if(elevation(satrec,future) > 0){
        nextPassMin = Math.ceil(t/60);
        break;
      }
    }

    info.innerHTML = `
      <h2>ISS Live Tracker â€” ShkodÃ«r</h2>
      Latitude: ${obsLat}<br>
      Longitude: ${obsLon}<br>
      ISS Position: ${pos.lat.toFixed(3)}, ${pos.lon.toFixed(3)}<br>
      Speed: ${speedKmS} km/s (~27,600 km/h)<br>
      Next pass over ShkodÃ«r in ~${nextPassMin} min<br>
      Time: ${now.toLocaleTimeString()}
    `;

    requestAnimationFrame(update);
  }
  update();
})();
</script>

</body>
</html>

