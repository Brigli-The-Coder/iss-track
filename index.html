<!doctype html>
<html>
<head>
<meta charset="utf-8" />
<title>ISS Live Tracker â€” Universe Layout</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
<style>
  body {
    margin:0;
    font-family:'Orbitron', sans-serif;
    background:#000;
    color:#fff;
    overflow-x:hidden;
    background-image: url('https://img.freepik.com/free-photo/earth-seen-from-space_23-2150528643.jpg');
    background-size: cover;
    background-repeat: no-repeat;
    background-position: center;
  }

  .container {
    width:70%;
    margin: 30px auto;
    background: rgba(0,0,0,0.6);
    padding:20px;
    border-radius:12px;
    box-shadow: 0 0 30px rgba(0,255,255,0.2);
  }

  #info {
    font-size:16px;
    line-height:1.5;
  }

  #map {
    height:400px;
    border-radius:12px;
    margin-top:10px;
    border:1px solid #0ff;
  }

  #input-container {
    display:flex;
    justify-content: space-around;
    margin-top:10px;
    font-size:16px;
  }

  #input-container label input {
    width:120px;
    padding:5px;
    border-radius:6px;
    border:none;
    font-family:'Orbitron';
    font-weight:700;
    text-align:center;
  }

  h2 {
    text-align:center;
    color:#0ff;
    margin-bottom:10px;
    text-shadow: 0 0 10px #0ff;
  }

  /* Mobile responsiveness */
  @media (max-width: 768px) {
    .container {
      width:80%;
      padding:15px;
    }

    #info {
      font-size:18px;
    }

    #input-container {
      flex-direction: column;
      align-items: center;
      gap: 10px;
      font-size:18px;
    }

    #input-container label input {
      width:80%;
      font-size:18px;
    }

    #map {
      height:60vh; /* mÃ« e madhe nÃ« mobile */
    }

    h2 {
      font-size:1.8em;
    }

    #fullscreenModal h1 {
      font-size:2.5em !important;
    }
  }

  @media (max-width: 480px) {
    #info {
      font-size:20px;
    }

    #input-container label input {
      width:80%;
      font-size:20px;
    }

    #map {
      height:70vh;
    }

    h2 {
      font-size:2em;
    }

    #fullscreenModal h1 {
      font-size:2em !important;
    }
  }
</style>
</head>
<body>

<div class="container" id="input-container">
  <label>Latitude: <input id="input-lat" value="42.068" /></label>
  <label>Longitude: <input id="input-lon" value="19.512" /></label>
</div>

<div class="container" id="info">
  Loading ISS data...
</div>

<div class="container" id="map"></div>

<script src="https://unpkg.com/satellite.js/dist/satellite.min.js"></script>
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<audio id="openSound" src="./mixkit-deep-space-atmosphere-2009.wav"></audio>

<div id="fullscreenModal" style="
  position: fixed;
  top:0; left:0;
  width:100%; height:100%;
  background-image: url('https://img.freepik.com/free-photo/earth-seen-from-space_23-2150528643.jpg');
  background-size: cover;
  background-position: center;
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 1000;
  opacity: 1;
  transform: scale(1);
  transition: transform 1s ease, opacity 1s ease;
">
<h1 style="
  color: transparent;
  font-size: 3em;
  -webkit-text-stroke: 1px #0ff;
  text-align: center;
">
  Welcome to the ISS Live Tracker ðŸš€
</h1>
</div>

<script>
const modal = document.getElementById('fullscreenModal');
const openSound = document.getElementById('openSound');
modal.addEventListener('click', () => {
  openSound.play();
  modal.style.transform = 'scale(3)';
  modal.style.opacity = '0';
  setTimeout(() => modal.style.display='none', 1000);
});

let obsLat = parseFloat(document.getElementById('input-lat').value);
let obsLon = parseFloat(document.getElementById('input-lon').value);
const info = document.getElementById('info');

const map = L.map('map').setView([obsLat, obsLon], 5);
L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
    attribution: 'Tiles &copy; Esri &mdash; Source: Esri, NASA, USGS',
    maxZoom: 19
}).addTo(map);

let observerMarker = L.marker([obsLat,obsLon]).addTo(map).bindPopup('ShkodÃ«r').openPopup();
let issMarker = null, issTrail = null;

document.getElementById('input-lat').addEventListener('change',(e)=>{
  obsLat=parseFloat(e.target.value);
  observerMarker.setLatLng([obsLat,obsLon]);
  map.setView([obsLat,obsLon],5);
});
document.getElementById('input-lon').addEventListener('change',(e)=>{
  obsLon=parseFloat(e.target.value);
  observerMarker.setLatLng([obsLat,obsLon]);
  map.setView([obsLat,obsLon],5);
});

async function fetchTLE(){
  const res = await fetch('https://celestrak.com/NORAD/elements/stations.txt');
  const txt = await res.text();
  const lines = txt.split('\n').map(s=>s.trim()).filter(Boolean);
  for(let i=0;i<lines.length;i++){
    if(lines[i].toUpperCase().includes('ZARYA')){
      return satellite.twoline2satrec(lines[i+1], lines[i+2]);
    }
  }
  throw new Error('ISS TLE not found');
}

function getLatLon(satrec,date){
  const pv = satellite.propagate(satrec,date);
  if(!pv.position) return null;
  const gmst = satellite.gstime(date);
  const pos = satellite.eciToGeodetic(pv.position,gmst);
  return {
    lat:satellite.radiansToDegrees(pos.latitude),
    lon:satellite.radiansToDegrees(pos.longitude)
  };
}

function elevation(satrec, date){
  const pv = satellite.propagate(satrec,date);
  if(!pv.position) return -1;
  const gmst = satellite.gstime(date);
  const posEcf = satellite.eciToEcf(pv.position, gmst);
  const observerGd = {
    latitude: satellite.degreesToRadians(obsLat),
    longitude: satellite.degreesToRadians(obsLon),
    height: 0
  };
  const obsEcf = satellite.geodeticToEcf(observerGd);
  const rx = posEcf.x - obsEcf.x;
  const ry = posEcf.y - obsEcf.y;
  const rz = posEcf.z - obsEcf.z;
  const lat = observerGd.latitude;
  const lon = observerGd.longitude;
  const sinLat = Math.sin(lat), cosLat = Math.cos(lat);
  const sinLon = Math.sin(lon), cosLon = Math.cos(lon);
  const topX = -sinLon*rx + cosLon*ry;
  const topY = -cosLon*sinLat*rx - sinLat*sinLon*ry + cosLat*rz;
  const topZ = cosLat*cosLon*rx + cosLat*sinLon*ry + sinLat*rz;
  const rangeKm = Math.sqrt(topX*topX + topY*topY + topZ*topZ);
  const el = Math.asin(topZ/rangeKm) * 180/Math.PI;
  return el;
}

(async()=>{
  const satrec = await fetchTLE();
  const speedKmS = 7.66;

  function update(){
    const now = new Date();
    const pos = getLatLon(satrec, now);
    if(!pos) return;

    if(issMarker) issMarker.setLatLng([pos.lat,pos.lon]);
    else issMarker = L.circleMarker([pos.lat,pos.lon],{
      radius:10,
      color:'#0ff',
      fillColor:'#0ff',
      fillOpacity:1
    }).addTo(map).bindPopup('ISS Current Position').openPopup();

    const points=[];
    for(let t=0;t<=120;t+=5){
      const future = getLatLon(satrec,new Date(now.getTime()+t*1000));
      if(future) points.push([future.lat,future.lon]);
    }
    if(issTrail) map.removeLayer(issTrail);
    issTrail = L.polyline(points,{color:'#f0f',weight:2,opacity:0.8}).addTo(map);

    let nextPassMin = '-';
    for(let t=0;t<24*60*60;t+=10){
      const future = new Date(now.getTime()+t*1000);
      if(elevation(satrec,future) > 0){
        nextPassMin = Math.ceil(t/60);
        break;
      }
    }

    info.innerHTML = `
      <h2>ISS Live Tracker â€” ShkodÃ«r</h2>
      Latitude: ${obsLat}<br>
      Longitude: ${obsLon}<br>
      ISS Position: ${pos.lat.toFixed(3)}, ${pos.lon.toFixed(3)}<br>
      Speed: ${speedKmS} km/s (~27,600 km/h)<br>
      Next pass over ShkodÃ«r in ~${nextPassMin} min<br>
      Time: ${now.toLocaleTimeString()}
    `;

    requestAnimationFrame(update);
  }

  update();
})();
</script>
</body>
</html>

